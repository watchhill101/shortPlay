# çŸ­å‰§å¹³å°æ•°æ®æ¨¡å‹æ–‡æ¡£

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„æ¦‚è§ˆ

### ğŸ§‘â€ğŸ’¼ ç”¨æˆ·ç®¡ç†æ¨¡å—

#### 1. ç”¨æˆ·è¡¨ (User)

**é›†åˆå**: `User`
**åŠŸèƒ½**: å­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼Œæ”¯æŒæ‰‹æœºå·å’ŒæŠ–éŸ³ç™»å½•
**ä¸»è¦å­—æ®µ**:

- `mobilePhoneNumber`: æ‰‹æœºå· (å”¯ä¸€ï¼Œç¨€ç–ç´¢å¼•)
- `douyinProfile`: æŠ–éŸ³ç”¨æˆ·ä¿¡æ¯
  - `openId`: æŠ–éŸ³openId (å”¯ä¸€ï¼Œç¨€ç–ç´¢å¼•)
  - `unionId`: æŠ–éŸ³unionId (å”¯ä¸€ï¼Œç¨€ç–ç´¢å¼•)
  - `nickname`: æŠ–éŸ³æ˜µç§°
  - `avatar`: æŠ–éŸ³å¤´åƒ
  - `gender`: æ€§åˆ« (0-æœªçŸ¥, 1-ç”·, 2-å¥³)
  - `city/province/country`: åœ°ç†ä¿¡æ¯
- `nickname`: ç”¨æˆ·æ˜µç§° (å¿…å¡«)
- `avatar`: å¤´åƒURL
- `status`: ç”¨æˆ·çŠ¶æ€ (active/inactive/banned)
- `lastLoginAt`: æœ€åç™»å½•æ—¶é—´
  **å…³è”å…³ç³»**: ä¸€å¯¹å¤šå…³è” Collectionã€Collectã€Commentã€PlayDataã€Wallet

#### 2. é’±åŒ…è¡¨ (Wallet)

**é›†åˆå**: `Wallet`
**åŠŸèƒ½**: ç”¨æˆ·é’±åŒ…ç³»ç»Ÿï¼Œç®¡ç†ä½™é¢å’Œäº¤æ˜“è®°å½•
**ä¸»è¦å­—æ®µ**:

- `user`: å…³è”ç”¨æˆ·ID (ä¸€å¯¹ä¸€ï¼Œå”¯ä¸€)
- `balance`: ä½™é¢ (Decimal128ç²¾ç¡®ç±»å‹)
- `transactions`: äº¤æ˜“è®°å½•æ•°ç»„ (å†…åµŒå­æ–‡æ¡£)
  - `type`: äº¤æ˜“ç±»å‹ (deposit/withdrawal/reward/purchase)
  - `amount`: äº¤æ˜“é‡‘é¢ (Decimal128)
  - `description`: äº¤æ˜“æè¿°
  - `timestamp`: äº¤æ˜“æ—¶é—´
    **å…³è”å…³ç³»**: ä¸€å¯¹ä¸€å…³è” User

#### 3. åå°ç”¨æˆ·è¡¨ (BackgroundUser)

**é›†åˆå**: `BackgroundUser`
**åŠŸèƒ½**: åå°ç®¡ç†å‘˜ç”¨æˆ·ï¼Œè´Ÿè´£å†…å®¹åˆ›å»ºå’Œç®¡ç†
**ä¸»è¦å­—æ®µ**:

- `account`: ç®¡ç†å‘˜è´¦å· (å”¯ä¸€ï¼Œå¿…å¡«)
- `password`: å¯†ç  (å¿…å¡«)
- `role`: ç®¡ç†å‘˜è§’è‰² (admin/content_manager/moderator)
- `name`: ç®¡ç†å‘˜å§“å (å¿…å¡«)
- `email`: é‚®ç®±åœ°å€
- `status`: è´¦å·çŠ¶æ€ (active/inactive/locked)
- `lastLoginAt`: æœ€åç™»å½•æ—¶é—´
  **å…³è”å…³ç³»**: ä¸€å¯¹å¤šå…³è” Collection

### ğŸ“š å†…å®¹ç®¡ç†æ¨¡å—

#### 4. åˆ†ç±»è¡¨ (Classifier)

**é›†åˆå**: `Classifier`
**åŠŸèƒ½**: çŸ­å‰§å†…å®¹åˆ†ç±»ç®¡ç†
**ä¸»è¦å­—æ®µ**:

- `name`: åˆ†ç±»åç§° (å”¯ä¸€ï¼Œå¿…å¡«)
- `description`: åˆ†ç±»æè¿°
- `order`: æ’åºæƒé‡ (æ•°å­—è¶Šå°è¶Šé å‰)
- `status`: åˆ†ç±»çŠ¶æ€ (active/inactive)
  **å…³è”å…³ç³»**: ä¸€å¯¹å¤šå…³è” Collection

#### 5. åˆé›†è¡¨ (Collection)

**é›†åˆå**: `Collection`
**åŠŸèƒ½**: çŸ­å‰§åˆé›†ä¿¡æ¯ï¼ŒåŒ…å«å¤šä¸ªä½œå“
**ä¸»è¦å­—æ®µ**:

- `backgroundUser`: å…³è”åå°ç®¡ç†å‘˜ç”¨æˆ·ID (å…³è”BackgroundUser)
- `title`: åˆé›†æ ‡é¢˜ (å¿…å¡«ï¼Œæœ‰ç´¢å¼•)
- `description`: åˆé›†ç®€ä»‹ (å¿…å¡«)
- `coverImage`: å°é¢å›¾URL (å¿…å¡«)
- `classifier`: å…³è”åˆ†ç±»ID (å¿…å¡«ï¼Œæœ‰ç´¢å¼•)
- `status`: çŠ¶æ€ (draft/published/archived)
- `tags`: æ ‡ç­¾æ•°ç»„
- `isFinished`: æ˜¯å¦å®Œç»“
- **æ€§èƒ½ç¼“å­˜å­—æ®µ**:
  - `workCount`: ä½œå“æ•°é‡
  - `totalPlayCount`: æ€»æ’­æ”¾é‡
  - `collectCount`: æ”¶è—æ¬¡æ•°
    **å…³è”å…³ç³»**:
- å¤šå¯¹ä¸€å…³è” BackgroundUser (åå°ç®¡ç†å‘˜)
- å¤šå¯¹ä¸€å…³è” Classifier
- ä¸€å¯¹å¤šå…³è” Work
- ä¸€å¯¹å¤šå…³è” Collectã€Commentã€PlayData

#### 6. ä½œå“è¡¨ (Work)

**é›†åˆå**: `Work`
**åŠŸèƒ½**: çŸ­å‰§å•é›†ä½œå“ä¿¡æ¯
**ä¸»è¦å­—æ®µ**:

- `collectionId`: æ‰€å±åˆé›†ID (å¿…å¡«ï¼Œæœ‰ç´¢å¼•)
- `title`: ä½œå“æ ‡é¢˜ (å¿…å¡«)
- `episodeNumber`: å‰§é›†ç¼–å· (å¿…å¡«)
- `videoUrl`: è§†é¢‘åœ°å€ (å¿…å¡«)
- `coverImage`: å•é›†å°é¢å›¾
- `duration`: è§†é¢‘æ—¶é•¿(ç§’) (å¿…å¡«)
- `status`: çŠ¶æ€ (draft/published)
- **æ€§èƒ½ç¼“å­˜å­—æ®µ**:
  - `playCount`: æ’­æ”¾æ¬¡æ•°
  - `likeCount`: ç‚¹èµæ¬¡æ•°
  - `commentCount`: è¯„è®ºæ¬¡æ•°
    **ç´¢å¼•**: å¤åˆå”¯ä¸€ç´¢å¼• (collectionId + episodeNumber)
    **å…³è”å…³ç³»**:
- å¤šå¯¹ä¸€å…³è” Collection
- ä¸€å¯¹å¤šå…³è” PlayData

### ğŸ“ˆ ç”¨æˆ·è¡Œä¸ºæ¨¡å—

#### 7. æ’­æ”¾æ•°æ®è¡¨ (PlayData)

**é›†åˆå**: `PlayData`
**åŠŸèƒ½**: è®°å½•ç”¨æˆ·æ’­æ”¾è¡Œä¸ºæ•°æ®
**ä¸»è¦å­—æ®µ**:

- `user`: ç”¨æˆ·ID (å¿…å¡«ï¼Œæœ‰ç´¢å¼•)
- `collection`: åˆé›†ID (å¿…å¡«ï¼Œæœ‰ç´¢å¼•)
- `work`: ä½œå“ID (å¿…å¡«ï¼Œæœ‰ç´¢å¼•)
- `playDuration`: æ’­æ”¾æ—¶é•¿(ç§’) (å¿…å¡«)
- `isFinished`: æ˜¯å¦æ’­æ”¾å®Œæˆ
  **æ—¶é—´æˆ³**: ä»…è®°å½•åˆ›å»ºæ—¶é—´
  **å…³è”å…³ç³»**: å¤šå¯¹ä¸€å…³è” Userã€Collectionã€Work

#### 8. æ”¶è—è¡¨ (Collect)

**é›†åˆå**: `Collect`
**åŠŸèƒ½**: ç”¨æˆ·æ”¶è—åˆé›†è®°å½•
**ä¸»è¦å­—æ®µ**:

- `user`: ç”¨æˆ·ID (å¿…å¡«)
- `collection`: åˆé›†ID (å¿…å¡«)
  **ç´¢å¼•**: å¤åˆå”¯ä¸€ç´¢å¼• (user + collection) é˜²æ­¢é‡å¤æ”¶è—
  **æ—¶é—´æˆ³**: ä»…è®°å½•åˆ›å»ºæ—¶é—´
  **å…³è”å…³ç³»**: å¤šå¯¹ä¸€å…³è” Userã€Collection

#### 9. è¯„è®ºè¡¨ (Comment)

**é›†åˆå**: `Comment`
**åŠŸèƒ½**: åˆé›†è¯„è®ºç³»ç»Ÿï¼Œæ”¯æŒå›å¤
**ä¸»è¦å­—æ®µ**:

- `collection`: åˆé›†ID (å¿…å¡«ï¼Œæœ‰ç´¢å¼•)
- `user`: è¯„è®ºç”¨æˆ·ID (å¿…å¡«)
- `userInfo`: ç”¨æˆ·ä¿¡æ¯å†—ä½™å­˜å‚¨ (æ€§èƒ½ä¼˜åŒ–)
  - `nickname`: ç”¨æˆ·æ˜µç§°
  - `avatar`: ç”¨æˆ·å¤´åƒ
- `content`: è¯„è®ºå†…å®¹ (å¿…å¡«)
- `parentComment`: çˆ¶è¯„è®ºID (æ”¯æŒå›å¤åŠŸèƒ½)
- `likeCount`: ç‚¹èµæ•°
  **å…³è”å…³ç³»**: å¤šå¯¹ä¸€å…³è” Collectionã€Userï¼Œæ”¯æŒè‡ªå…³è”(å›å¤)

### ğŸ¯ è¿è¥ç®¡ç†æ¨¡å—

#### 10. æ´»åŠ¨è¡¨ (Activity)

**é›†åˆå**: `Activity`
**åŠŸèƒ½**: å¹³å°æ´»åŠ¨å’Œå¹¿å‘Šç®¡ç†
**ä¸»è¦å­—æ®µ**:

- `title`: æ´»åŠ¨æ ‡é¢˜ (å¿…å¡«)
- `description`: æ´»åŠ¨æè¿°
- `imageUrl`: æ´»åŠ¨å›¾ç‰‡/Banner (å¿…å¡«)
- `link`: è·³è½¬é“¾æ¥
- `type`: æ´»åŠ¨ç±»å‹ (banner/popup/event)
- `order`: æ’åºæƒé‡
- `status`: çŠ¶æ€ (active/inactive/scheduled)
- `startDate`: å¼€å§‹æ—¶é—´ (å¿…å¡«)
- `endDate`: ç»“æŸæ—¶é—´ (å¿…å¡«)
  **å…³è”å…³ç³»**: ç‹¬ç«‹è¡¨ï¼Œæ— å¤–é”®å…³è”

## ğŸ”— å…³ç³»å›¾è°±

```mermaid
User (ç”¨æˆ·)
â”œâ”€â”€ 1:1 â†’ Wallet (é’±åŒ…)
â”œâ”€â”€ 1:N â†’ Collect (æ”¶è—)
â”œâ”€â”€ 1:N â†’ Comment (è¯„è®º)
â””â”€â”€ 1:N â†’ PlayData (æ’­æ”¾æ•°æ®)

BackgroundUser (åå°ç®¡ç†å‘˜)
â””â”€â”€ 1:N â†’ Collection (åˆé›†)

Classifier (åˆ†ç±»)
â””â”€â”€ 1:N â†’ Collection (åˆé›†)

Collection (åˆé›†)
â”œâ”€â”€ N:1 â†’ BackgroundUser (åå°ç®¡ç†å‘˜ç”¨æˆ·)
â”œâ”€â”€ N:1 â†’ Classifier (åˆ†ç±»)
â”œâ”€â”€ 1:N â†’ Work (ä½œå“)
â”œâ”€â”€ 1:N â†’ Collect (æ”¶è—)
â”œâ”€â”€ 1:N â†’ Comment (è¯„è®º)
â””â”€â”€ 1:N â†’ PlayData (æ’­æ”¾æ•°æ®)

Work (ä½œå“)
â”œâ”€â”€ N:1 â†’ Collection (åˆé›†)
â””â”€â”€ 1:N â†’ PlayData (æ’­æ”¾æ•°æ®)

Activity (æ´»åŠ¨)
â””â”€â”€ [ç‹¬ç«‹è¡¨ï¼Œæ— å…³è”]
```

## ğŸ“‹ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### ç´¢å¼•è®¾è®¡

- **ç”¨æˆ·è¡¨**: mobilePhoneNumber, douyinProfile.openId, douyinProfile.unionId (ç¨€ç–å”¯ä¸€ç´¢å¼•)
- **åå°ç”¨æˆ·è¡¨**: account, status
- **åˆ†ç±»è¡¨**: status, order
- **åˆé›†è¡¨**: backgroundUser, title, classifier, status
- **ä½œå“è¡¨**: collectionId, status, (collectionId + episodeNumber) å¤åˆå”¯ä¸€ç´¢å¼•
- **æ’­æ”¾æ•°æ®**: user, collection, work
- **æ”¶è—è¡¨**: (user + collection) å¤åˆå”¯ä¸€ç´¢å¼•
- **è¯„è®ºè¡¨**: collection
- **æ´»åŠ¨è¡¨**: status, (startDate + endDate)

### æ•°æ®å†—ä½™ç­–ç•¥

- **åˆé›†è¡¨**: ç¼“å­˜ workCount, totalPlayCount, collectCount
- **ä½œå“è¡¨**: ç¼“å­˜ playCount, likeCount, commentCount
- **è¯„è®ºè¡¨**: å†—ä½™å­˜å‚¨ userInfo (nickname, avatar)

### æ•°æ®ç±»å‹ä¼˜åŒ–

- **é‡‘é¢å­—æ®µ**: ä½¿ç”¨ Decimal128 é¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜
- **æ—¶é—´æˆ³**: æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©æ€§å¯ç”¨ updatedAt

## ğŸš€ æ‰©å±•å»ºè®®

1. **ç¼“å­˜å±‚**: Redisç¼“å­˜çƒ­é—¨æ•°æ®
2. **æœç´¢å¼•æ“**: Elasticsearchæ”¯æŒå…¨æ–‡æœç´¢
3. **CDN**: è§†é¢‘å’Œå›¾ç‰‡èµ„æºåˆ†å‘
4. **åˆ†åº“åˆ†è¡¨**: å¤§æ•°æ®é‡æ—¶è€ƒè™‘åˆ†ç‰‡ç­–ç•¥
5. **æ¶ˆæ¯é˜Ÿåˆ—**: å¼‚æ­¥å¤„ç†ç»Ÿè®¡æ•°æ®æ›´æ–°
